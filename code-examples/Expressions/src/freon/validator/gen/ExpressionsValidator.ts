// Generated by the Freon Language Generator.
import { FreValidator, FreError, FreCompositeTyper, FreNode } from "@freon4dsl/core";
// import { FreNode } from "../../language/gen/index.js";
import { ExpressionsNonOptionalsChecker } from "./ExpressionsNonOptionalsChecker.js";
import { ExpressionsValidationRulesChecker } from "./ExpressionsValidationRulesChecker.js";
import { ExpressionsReferenceChecker } from "./ExpressionsReferenceChecker.js";
import { ExpressionsWalker, ExpressionsWorker } from "../../utils/gen/index.js";
import { freonConfiguration } from "../../config/FreonConfiguration.js";

/**
 * Interface 'ExpressionsCheckerInterface' represents any object that traverses the model tree and checks
 * its nodes, where any errors are deposited in 'errorList'.
 * Every checker that is used by the validator 'ExpressionsValidator' should implement this interface.
 */
export interface ExpressionsCheckerInterface extends ExpressionsWorker {
    errorList: FreError[];
}

/**
 * Class ExpressionsValidator implements the validator generated from, if present, the validator definition,
 * otherwise this class implements the default validator.
 * The implementation uses the visitor pattern to traverse the tree. Class ExpressionsWalker implements
 * the actual checking of each node in the tree.
 */
export class ExpressionsValidator implements FreValidator {
    /**
     * Returns the list of errors found in 'modelelement'.
     * This method uses the visitor pattern to traverse the tree with 'modelelement' as top node,
     * where classes ExpressionsNonOptionalsChecker, ExpressionsReferenceChecker,  implements the actual checking of each node in the tree.
     *
     * @param modelelement
     * @param includeChildren if true, the children of 'modelelement' are also checked.
     * The default for 'includeChildren' is true.
     */
    public validate(modelelement: FreNode, includeChildren: boolean = true): FreError[] {
        // initialize the errorlist
        const errorlist: FreError[] = [];

        // create the walker over the model tree
        const myWalker = new ExpressionsWalker();

        // create the checker on non-optional parts
        let myChecker = new ExpressionsNonOptionalsChecker();
        myChecker.errorList = errorlist;
        // and add the checker to the walker
        myWalker.myWorkers.push(myChecker);

        // create the checker on references
        myChecker = new ExpressionsReferenceChecker();
        myChecker.errorList = errorlist;
        // and add the checker to the walker
        myWalker.myWorkers.push(myChecker);

        // create the checker based on the rules in the validation definition (.valid file)
        myChecker = new ExpressionsValidationRulesChecker();
        myChecker.errorList = errorlist;
        // and add the checker to the walker
        myWalker.myWorkers.push(myChecker);

        // add any custom validations
        for (let checker of freonConfiguration.customValidations) {
            checker.errorList = errorlist;
            myWalker.myWorkers.push(checker);
        }

        // do the work
        myWalker.walk(modelelement, () => {
            return includeChildren;
        });

        // return any errors
        return errorlist;
    }
}
