// Generated by the ProjectIt Language Generator.
import { PiNamedElement, PiStdlib, Language } from "@projectit/core";
import { EntityMetaType, AttributeType, MockEnumeration } from "../../language/gen";

/**
 * Class EntityStdlib provides an entry point for all predefined elements in language Entity.
 * It holds all instances of limited concepts as defined in the language definition file.
 *
 * This class uses the singleton pattern to ensure that only one instance of the class is present.
 */
export class EntityStdlib implements PiStdlib {
    private static stdlib: PiStdlib; // the only instance of this class

    /**
     * This method implements the singleton pattern
     */
    public static getInstance(): PiStdlib {
        if (this.stdlib === undefined || this.stdlib === null) {
            this.stdlib = new EntityStdlib();
        }
        return this.stdlib;
    }

    public elements: PiNamedElement[] = []; // the predefined elements of language Entity

    /**
     * A private constructor, as demanded by the singleton pattern,
     * in which the list of predefined elements is filled.
     */
    private constructor() {
        this.elements.push(AttributeType.String);
        this.elements.push(AttributeType.Integer);
        this.elements.push(AttributeType.Boolean);
        this.elements.push(AttributeType.ANY);
        this.elements.push(MockEnumeration.EnumValue1);
        this.elements.push(MockEnumeration.EnumValue2);
        this.elements.push(MockEnumeration.EnumValue3);
    }

    /**
     * Returns the element named 'name', if it can be found in this library.
     * If the element can not be found, 'null' is returned.
     * When 'metatype' is provided, the element is only returned when it is
     * an instance of this metatype.
     * @param name
     * @param metatype
     */
    public find(name: string, metatype?: EntityMetaType): PiNamedElement {
        if (!!name) {
            const possibles = this.elements.filter(elem => elem.name === name);
            if (possibles.length !== 0) {
                if (metatype) {
                    for (const elem of possibles) {
                        const concept = elem.piLanguageConcept();
                        if (concept === metatype || Language.getInstance().subConcepts(metatype).includes(elem.piLanguageConcept())) {
                            return elem;
                        }
                    }
                } else {
                    return possibles[0];
                }
            }
        }
        return null;
    }
}
